<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>World Explorer - Country Information</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        #map { height: 500px; }
        .country-card:hover { transform: translateY(-5px); }
        .dark .bg-white { background-color: #1a202c !important; }
        .dark .text-gray-800 { color: #e2e8f0 !important; }
        .dark .border-gray-200 { border-color: #4a5568 !important; }
        .dark body { background-color: #1a202c; color: #e2e8f0; }
        .dark .bg-blue-50 { background-color: #2d3748 !important; }
        .dark .text-gray-500 { color: #a0aec0 !important; }
        .dark .text-gray-900 { color: #e2e8f0 !important; }
        .dark .bg-gray-200 { background-color: #4a5568 !important; color: #e2e8f0 !important; }
        .dark .bg-gray-700 { background-color: #2d3748 !important; }
        .dark .bg-gray-800 { background-color: #1a202c !important; }
        .dark .divide-gray-700 { border-color: #4a5568 !important; }
        [hidden] { display: none !important; }
        
        /* Bengali font */
        @import url('https://fonts.googleapis.com/css2?family=Hind+Siliguri&display=swap');
        .bn { font-family: 'Hind Siliguri', sans-serif; }
        
        /* Grid layout for info sections */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1rem;
        }
        
        /* More Info button styling */
        .more-info-btn {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            transition: all 0.3s ease;
        }
        .more-info-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px -10px rgba(59, 130, 246, 0.5);
        }
        
        /* 3D Globe Animation */
        .globe-container {
            width: 40px;
            height: 40px;
            display: inline-block;
            margin-right: 10px;
            vertical-align: middle;
        }
        
        .globe {
            width: 100%;
            height: 100%;
            background-image: url('https://cdn.jsdelivr.net/gh/apoorv-pro/3d-globe@main/globe.png');
            background-size: cover;
            border-radius: 50%;
            animation: rotate 20s linear infinite;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
        }
        
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        /* Translator Slider */
        .translate-container {
            position: relative;
            width: 40px;
            transition: all 0.3s ease;
        }
        
        .translate-container.expanded {
            width: 200px;
        }
        
        .translate-toggle {
            position: absolute;
            right: 0;
            top: 0;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 10;
        }
        
        .translate-content {
            position: absolute;
            right: 40px;
            top: 0;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
        }
        
        .translate-container.expanded .translate-content {
            opacity: 1;
            pointer-events: all;
        }
        
        /* Dark mode toggle */
        .dark-mode-toggle {
            position: relative;
            width: 60px;
            height: 30px;
            border-radius: 15px;
            background: #e2e8f0;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .dark-mode-toggle.dark {
            background: #4a5568;
        }
        
        .dark-mode-toggle .toggle-slider {
            position: absolute;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #3b82f6;
            top: 3px;
            left: 3px;
            transition: all 0.3s ease;
        }
        
        .dark-mode-toggle.dark .toggle-slider {
            left: 33px;
        }
        
        /* AI Button */
        .ai-button {
            background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%);
            color: white;
            border-radius: 8px;
            padding: 8px 12px;
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(139, 92, 246, 0.2);
        }
        
        .ai-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(139, 92, 246, 0.3);
        }
        
        /* Search bar */
        .search-container {
            position: relative;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            overflow: hidden;
        }
        
        .search-input {
            width: 100%;
            padding: 14px 20px 14px 50px;
            border: none;
            outline: none;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .search-icon {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: #64748b;
        }
        
        /* Navigation */
        .nav-item {
            position: relative;
            padding: 10px 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .nav-item::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 2px;
            background: #3b82f6;
            transition: all 0.3s ease;
        }
        
        .nav-item:hover::after {
            width: 100%;
        }
        
        /* Weather icons */
        .weather-icon {
            font-size: 48px;
            margin-right: 15px;
        }
        
        /* Comparison table */
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .comparison-table th, .comparison-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .comparison-table tr:last-child td {
            border-bottom: none;
        }
        
        .dark .comparison-table th, .dark .comparison-table td {
            border-bottom: 1px solid #4a5568;
        }
        
        /* Page transitions */
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .info-grid {
                grid-template-columns: 1fr;
            }
            
            .translate-container.expanded {
                width: 180px;
            }
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900">
    <!-- Main Container -->
    <div class="container mx-auto px-4 py-8">
        <!-- Header with Toggles -->
        <header class="flex justify-between items-center mb-8">
            <div class="flex items-center">
                <div class="globe-container">
                    <div class="globe"></div>
                </div>
                <h1 class="text-3xl font-bold text-blue-600 dark:text-blue-400">World Explorer</h1>
            </div>
            <div class="flex items-center space-x-4">
                <div class="translate-container" id="translateContainer">
                    <div class="translate-toggle" id="translateToggle">
                        <i class="fas fa-language"></i>
                    </div>
                    <div class="translate-content" id="google_translate_element"></div>
                </div>
                
                <div class="dark-mode-toggle" id="darkModeToggle">
                    <div class="toggle-slider flex items-center justify-center">
                        <i class="fas fa-moon text-white text-xs"></i>
                    </div>
                </div>
                
                <button id="aiButton" class="ai-button">
                    <i class="fas fa-comment-dots mr-2"></i>
                    <span>AI Assistant</span>
                </button>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="flex border-b border-gray-200 dark:border-gray-700 mb-8">
            <div class="nav-item text-blue-600 dark:text-blue-400 font-medium border-b-2 border-blue-600 dark:border-blue-400" data-page="home">
                <i class="fas fa-home mr-2"></i>
                Home
            </div>
            <div class="nav-item text-gray-600 dark:text-gray-300" data-page="saved">
                <i class="fas fa-bookmark mr-2"></i>
                Saved Countries
            </div>
            <div class="nav-item text-gray-600 dark:text-gray-300" data-page="details">
                <i class="fas fa-file-pdf mr-2"></i>
                Country Details
            </div>
            <div class="nav-item text-gray-600 dark:text-gray-300" data-page="ai">
                <i class="fas fa-comment-dots mr-2"></i>
                AI Assistant
            </div>
        </nav>

        <!-- Home Page -->
        <div id="home-page" class="page active">
            <!-- Search Bar with Autocomplete -->
            <div class="relative mb-8">
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input id="searchInput" type="text" placeholder="Search for a country..." 
                           class="search-input dark:bg-gray-800 dark:text-white">
                </div>
                <div id="autocompleteResults" class="absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg hidden dark:bg-gray-800 dark:border-gray-600">
                    <!-- Results will be populated here -->
                </div>
            </div>

            <!-- Main Content -->
            <div class="flex flex-col lg:flex-row gap-8">
                <!-- Left Sidebar - Continent/Country Selection -->
                <div class="lg:w-1/4">
                    <div class="bg-white p-6 rounded-lg shadow-md mb-6 dark:bg-gray-800">
                        <h2 class="text-xl font-bold mb-4 dark:text-white flex items-center">
                            <i class="fas fa-globe-americas mr-2"></i>
                            <span data-i18n="selectContinent">Select Continent</span>
                        </h2>
                        <div id="continentButtons" class="grid grid-cols-2 gap-2">
                            <!-- Continents will be added here by JavaScript -->
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-lg shadow-md dark:bg-gray-800">
                        <h2 class="text-xl font-bold mb-4 dark:text-white flex items-center">
                            <i class="fas fa-flag mr-2"></i>
                            <span data-i18n="countries">Countries</span>
                        </h2>
                        <div id="countryList" class="space-y-2 max-h-96 overflow-y-auto">
                            <!-- Countries will be added here by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Main Content Area -->
                <div class="lg:w-3/4">
                    <!-- Map Container -->
                    <div class="bg-white p-6 rounded-lg shadow-md mb-6 dark:bg-gray-800">
                        <h2 class="text-xl font-bold mb-4 dark:text-white flex items-center">
                            <i class="fas fa-map-marked-alt mr-2"></i>
                            <span data-i18n="worldMap">World Map</span>
                        </h2>
                        <div id="map" class="rounded-lg"></div>
                    </div>

                    <!-- Country Information -->
                    <div id="countryInfo" class="bg-white p-6 rounded-lg shadow-md mb-6 hidden dark:bg-gray-800">
                        <div class="flex justify-between items-center mb-4">
                            <h2 id="countryName" class="text-2xl font-bold dark:text-white"></h2>
                            <div class="flex space-x-2">
                                <button id="saveCountryButton" class="p-2 bg-blue-100 rounded-full dark:bg-gray-700 text-blue-600 dark:text-blue-400 hover:bg-blue-200 dark:hover:bg-gray-600 transition">
                                    <i class="far fa-bookmark"></i>
                                </button>
                                <button id="speakButton" class="p-2 bg-blue-100 rounded-full dark:bg-gray-700 text-blue-600 dark:text-blue-400 hover:bg-blue-200 dark:hover:bg-gray-600 transition">
                                    <i id="speakIcon" class="fas fa-volume-up"></i>
                                </button>
                            </div>
                        </div>

                        <div class="info-grid gap-6 mb-6">
                            <!-- Basic Info -->
                            <div class="bg-blue-50 p-4 rounded-lg dark:bg-gray-700">
                                <h3 class="text-lg font-semibold mb-2 dark:text-white flex items-center">
                                    <i class="fas fa-info-circle mr-2"></i>
                                    <span data-i18n="basicInfo">Basic Information</span>
                                </h3>
                                <div class="space-y-2 dark:text-gray-300">
                                    <p><span class="font-semibold" data-i18n="area"><i class="fas fa-ruler-combined mr-2"></i>Area:</span> <span id="countryArea">-</span> km¬≤</p>
                                    <p><span class="font-semibold" data-i18n="population"><i class="fas fa-users mr-2"></i>Population:</span> <span id="countryPopulation">-</span></p>
                                    <p><span class="font-semibold" data-i18n="capital"><i class="fas fa-city mr-2"></i>Capital:</span> <span id="countryCapital">-</span></p>
                                    <p><span class="font-semibold" data-i18n="currency"><i class="fas fa-money-bill-wave mr-2"></i>Currency:</span> <span id="countryCurrency">-</span></p>
                                    <p><span class="font-semibold" data-i18n="languages"><i class="fas fa-language mr-2"></i>Languages:</span> <span id="countryLanguages">-</span></p>
                                    <p><span class="font-semibold" data-i18n="timezone"><i class="fas fa-clock mr-2"></i>Timezone:</span> <span id="countryTimezone">-</span></p>
                                    <p><span class="font-semibold" data-i18n="touristVisa"><i class="fas fa-passport mr-2"></i>Tourist Visa:</span> <span id="countryVisa">-</span></p>
                                </div>
                            </div>

                            <!-- Advanced Info -->
                            <div class="bg-blue-50 p-4 rounded-lg dark:bg-gray-700">
                                <h3 class="text-lg font-semibold mb-2 dark:text-white flex items-center">
                                    <i class="fas fa-chart-line mr-2"></i>
                                    <span>Advanced Information</span>
                                </h3>
                                <div class="space-y-2 dark:text-gray-300">
                                    <p><span class="font-semibold"><i class="fas fa-landmark mr-2"></i>Government:</span> <span id="countryGovernment">-</span></p>
                                    <p><span class="font-semibold"><i class="fas fa-chart-line mr-2"></i>GDP (nominal):</span> <span id="countryGDP">-</span></p>
                                    <p><span class="font-semibold"><i class="fas fa-shield-alt mr-2"></i>Military Rank:</span> <span id="countryArmyRank">-</span></p>
                                    <p><span class="font-semibold"><i class="fas fa-bolt mr-2"></i>Electricity:</span> <span id="countryElectricity">-</span></p>
                                    <p><span class="font-semibold"><i class="fas fa-car mr-2"></i>Driving Side:</span> <span id="countryDriving">-</span></p>
                                </div>
                            </div>

                            <!-- Flag and Weather -->
                            <div class="space-y-4">
                                <div class="bg-blue-50 p-4 rounded-lg dark:bg-gray-700">
                                    <h3 class="text-lg font-semibold mb-2 dark:text-white flex items-center">
                                        <i class="fas fa-flag mr-2"></i>
                                        <span data-i18n="flag">Flag</span>
                                    </h3>
                                    <img id="countryFlag" src="" alt="Country Flag" class="h-32 border dark:border-gray-600 mx-auto">
                                </div>
                                <div class="bg-blue-50 p-4 rounded-lg dark:bg-gray-700">
                                    <h3 class="text-lg font-semibold mb-2 dark:text-white flex items-center">
                                        <i class="fas fa-cloud-sun mr-2"></i>
                                        <span data-i18n="weather">Weather</span>
                                    </h3>
                                    <div id="countryWeather" class="flex items-center space-x-4 dark:text-gray-300">
                                        <div id="weatherIcon" class="weather-icon">‚òÄÔ∏è</div>
                                        <div>
                                            <p><span class="font-semibold" data-i18n="condition">Condition:</span> <span id="weatherCondition">-</span></p>
                                            <p><span class="font-semibold" data-i18n="temperature">Temperature:</span> <span id="weatherTemp">-</span>¬∞C</p>
                                            <p><span class="font-semibold" data-i18n="humidity">Humidity:</span> <span id="weatherHumidity">-</span>%</p>
                                            <p><span class="font-semibold" data-i18n="wind">Wind:</span> <span id="weatherWind">-</span> km/h</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- More Information Button -->
                        <div class="text-center mb-6">
                            <button id="moreInfoButton" class="more-info-btn px-6 py-3 text-white rounded-lg font-medium">
                                <span data-i18n="moreInfo">More Information</span>
                                <i class="fas fa-chevron-down ml-2"></i>
                            </button>
                        </div>

                        <!-- More Information Content (hidden by default) -->
                        <div id="moreInfoContent" class="hidden bg-blue-50 p-6 rounded-lg dark:bg-gray-700">
                            <h3 class="text-lg font-semibold mb-4 dark:text-white flex items-center">
                                <i class="fas fa-book-open mr-2"></i>
                                <span data-i18n="additionalInfo">Additional Information</span>
                            </h3>
                            <div id="wikipediaContent" class="dark:text-gray-300">
                                <p>Loading information from Wikipedia...</p>
                            </div>
                            <div class="mt-4 flex justify-between items-center">
                                <button id="readAloudButton" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition flex items-center">
                                    <i id="readAloudIcon" class="fas fa-volume-up mr-2"></i>
                                    <span>Read Aloud</span>
                                </button>
                                <div class="text-sm text-gray-500 dark:text-gray-400">
                                    <span id="characterCount">0</span> characters loaded
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Comparison Tool -->
                    <div id="comparisonTool" class="bg-white p-6 rounded-lg shadow-md mb-6 hidden dark:bg-gray-800">
                        <h2 class="text-xl font-bold mb-4 dark:text-white flex items-center">
                            <i class="fas fa-balance-scale mr-2"></i>
                            <span data-i18n="countryComparison">Country Comparison</span>
                        </h2>
                        <div class="flex flex-wrap items-center gap-4 mb-4">
                            <div class="flex-1">
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" data-i18n="compareWith">Compare with:</label>
                                <select id="compareCountry" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white"></select>
                            </div>
                            <button id="compareButton" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition flex items-center" data-i18n="compare">
                                <i class="fas fa-exchange-alt mr-2"></i>
                                <span>Compare</span>
                            </button>
                        </div>
                        <div id="comparisonResults" class="hidden overflow-x-auto">
                            <table class="comparison-table">
                                <thead>
                                    <tr class="bg-gray-100 dark:bg-gray-700">
                                        <th class="font-medium text-gray-700 dark:text-gray-300" data-i18n="metric">Metric</th>
                                        <th id="currentCountryHeader" class="font-medium text-gray-700 dark:text-gray-300"></th>
                                        <th id="comparedCountryHeader" class="font-medium text-gray-700 dark:text-gray-300"></th>
                                    </tr>
                                </thead>
                                <tbody id="comparisonTableBody">
                                    <!-- Comparison rows will be added here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Currency Converter -->
                    <div id="currencyConverter" class="bg-white p-6 rounded-lg shadow-md mb-6 hidden dark:bg-gray-800">
                        <h2 class="text-xl font-bold mb-4 dark:text-white flex items-center">
                            <i class="fas fa-money-bill-wave mr-2"></i>
                            <span data-i18n="currencyConverter">Currency Converter</span>
                        </h2>
                        <div class="flex flex-wrap items-center gap-4 mb-4">
                            <div class="flex-1">
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" data-i18n="convertWith">Convert with:</label>
                                <select id="convertCountry" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white"></select>
                            </div>
                            <div class="flex-1">
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Amount:</label>
                                <input type="number" id="convertAmount" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white" value="1" min="1">
                            </div>
                            <button id="convertButton" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition flex items-center" data-i18n="convert">
                                <i class="fas fa-calculator mr-2"></i>
                                <span>Convert</span>
                            </button>
                        </div>
                        <div id="conversionResult" class="mt-4 p-4 bg-blue-50 rounded-lg dark:bg-gray-700 hidden">
                            <div class="flex justify-between items-center">
                                <div class="text-lg font-semibold dark:text-white" id="conversionFrom"></div>
                                <div class="text-2xl font-bold text-blue-600 dark:text-blue-400" id="conversionTo"></div>
                            </div>
                            <div class="text-sm text-gray-500 dark:text-gray-400 mt-2" id="conversionRate"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Saved Countries Page -->
        <div id="saved-page" class="page">
            <div class="bg-white p-6 rounded-lg shadow-md dark:bg-gray-800">
                <h2 class="text-2xl font-bold mb-6 dark:text-white flex items-center">
                    <i class="fas fa-bookmark mr-2"></i>
                    <span>Saved Countries</span>
                </h2>
                <div id="savedCountriesList" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                    <!-- Saved countries will be added here -->
                </div>
            </div>
        </div>

        <!-- Country Details Page -->
        <div id="details-page" class="page">
            <div class="bg-white p-6 rounded-lg shadow-md dark:bg-gray-800">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold dark:text-white" id="detailsPageTitle">Country Details</h2>
                    <button id="downloadDetailsButton" class="px-4 py-2 bg-green-600 text-white rounded-md flex items-center hover:bg-green-700 transition">
                        <i class="fas fa-file-pdf mr-2"></i>
                        <span>Export as PDF</span>
                    </button>
                </div>
                <div id="countryDetailsContent">
                    <!-- Country details will be added here -->
                </div>
            </div>
        </div>

        <!-- AI Assistant Page -->
        <div id="ai-page" class="page">
            <div class="bg-white p-6 rounded-lg shadow-md dark:bg-gray-800">
                <h2 class="text-2xl font-bold mb-6 dark:text-white flex items-center">
                    <i class="fas fa-comment-dots mr-2"></i>
                    <span>AI Assistant</span>
                </h2>
                <div id="aiResponse" class="mb-4 max-h-[60vh] overflow-y-auto dark:text-gray-300 p-4 bg-gray-50 rounded-lg dark:bg-gray-700">
                    <div class="mb-2 text-left">
                        <span class="inline-block bg-gray-100 text-gray-800 px-3 py-1 rounded-lg dark:bg-gray-600 dark:text-gray-300">
                            <span data-i18n="aiWelcome">How can I help you with information about countries?</span>
                        </span>
                    </div>
                </div>
                <div class="flex mt-4">
                    <input id="aiQuery" type="text" class="flex-grow p-3 border rounded-l-md dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Ask about any country...">
                    <button id="aiSubmit" class="px-4 py-3 bg-blue-600 text-white rounded-r-md hover:bg-blue-700 transition" data-i18n="ask">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Google Translate API
        function googleTranslateElementInit() {
            new google.translate.TranslateElement({
                pageLanguage: 'en',
                includedLanguages: 'en,bn,hi,fr,es,de,it,pt,ru,zh-CN,ja,ar',
                layout: google.translate.TranslateElement.InlineLayout.SIMPLE
            }, 'google_translate_element');
        }

        // Load Google Translate script
        function loadGoogleTranslate() {
            var script = document.createElement('script');
            script.src = 'https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit';
            document.body.appendChild(script);
        }

        // Main Application
        document.addEventListener('DOMContentLoaded', function() {
            // Load Google Translate
            loadGoogleTranslate();
            
            // State management
            const state = {
                currentCountry: null,
                countries: [],
                continents: {},
                darkMode: false,
                language: 'en',
                savedCountries: JSON.parse(localStorage.getItem('savedCountries') || '[]'),
                isSpeaking: false,
                isReading: false,
                exchangeRates: {},
                weatherIcons: {
                    '01d': '‚òÄÔ∏è', '01n': 'üåô',
                    '02d': '‚õÖ', '02n': '‚õÖ',
                    '03d': '‚òÅÔ∏è', '03n': '‚òÅÔ∏è',
                    '04d': '‚òÅÔ∏è', '04n': '‚òÅÔ∏è',
                    '09d': 'üåßÔ∏è', '09n': 'üåßÔ∏è',
                    '10d': 'üå¶Ô∏è', '10n': 'üå¶Ô∏è',
                    '11d': '‚õàÔ∏è', '11n': '‚õàÔ∏è',
                    '13d': '‚ùÑÔ∏è', '13n': '‚ùÑÔ∏è',
                    '50d': 'üå´Ô∏è', '50n': 'üå´Ô∏è'
                },
                drivingSides: {
                    'left': 'Left side driving',
                    'right': 'Right side driving'
                },
                currentPage: 'home'
            };

            // Translation dictionary
            const translations = {
                'en': {
                    'selectContinent': 'Select Continent',
                    'countries': 'Countries',
                    'worldMap': 'World Map',
                    'basicInfo': 'Basic Information',
                    'area': 'Area',
                    'population': 'Population',
                    'capital': 'Capital',
                    'currency': 'Currency',
                    'languages': 'Languages',
                    'timezone': 'Timezone',
                    'touristVisa': 'Tourist Visa',
                    'gdp': 'GDP (nominal)',
                    'armyRank': 'Military Strength Rank',
                    'flag': 'Flag',
                    'weather': 'Weather',
                    'condition': 'Condition',
                    'temperature': 'Temperature',
                    'humidity': 'Humidity',
                    'wind': 'Wind',
                    'countryComparison': 'Country Comparison',
                    'compare': 'Compare',
                    'compareWith': 'Compare with',
                    'currencyConverter': 'Currency Converter',
                    'convertWith': 'Convert with',
                    'convert': 'Convert',
                    'exportPDF': 'Export as PDF',
                    'aiAssistant': 'AI Assistant',
                    'aiWelcome': 'How can I help you with information about countries?',
                    'ask': 'Ask',
                    'moreInfo': 'More Information',
                    'additionalInfo': 'Additional Information',
                    'metric': 'Metric'
                },
                'bn': {
                    'selectContinent': '‡¶Æ‡¶π‡¶æ‡¶¶‡ßá‡¶∂ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®',
                    'countries': '‡¶¶‡ßá‡¶∂‡¶∏‡¶Æ‡ßÇ‡¶π',
                    'worldMap': '‡¶¨‡¶ø‡¶∂‡ßç‡¶¨ ‡¶Æ‡¶æ‡¶®‡¶ö‡¶ø‡¶§‡ßç‡¶∞',
                    'basicInfo': '‡¶Æ‡ßå‡¶≤‡¶ø‡¶ï ‡¶§‡¶•‡ßç‡¶Ø',
                    'area': '‡¶Ü‡¶Ø‡¶º‡¶§‡¶®',
                    'population': '‡¶ú‡¶®‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ',
                    'capital': '‡¶∞‡¶æ‡¶ú‡¶ß‡¶æ‡¶®‡ßÄ',
                    'currency': '‡¶Æ‡ßÅ‡¶¶‡ßç‡¶∞‡¶æ',
                    'languages': '‡¶≠‡¶æ‡¶∑‡¶æ',
                    'timezone': '‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶Ö‡¶û‡ßç‡¶ö‡¶≤',
                    'touristVisa': '‡¶™‡¶∞‡ßç‡¶Ø‡¶ü‡¶® ‡¶≠‡¶ø‡¶∏‡¶æ',
                    'gdp': '‡¶ú‡¶ø‡¶°‡¶ø‡¶™‡¶ø (‡¶®‡¶æ‡¶Æ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞)',
                    'armyRank': '‡¶∏‡¶æ‡¶Æ‡¶∞‡¶ø‡¶ï ‡¶∂‡¶ï‡ßç‡¶§‡¶ø ‡¶∞‚Äç‡ßç‡¶Ø‡¶æ‡¶ô‡ßç‡¶ï',
                    'flag': '‡¶™‡¶§‡¶æ‡¶ï‡¶æ',
                    'weather': '‡¶Ü‡¶¨‡¶π‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ',
                    'condition': '‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ',
                    'temperature': '‡¶§‡¶æ‡¶™‡¶Æ‡¶æ‡¶§‡ßç‡¶∞‡¶æ',
                    'humidity': '‡¶Ü‡¶∞‡ßç‡¶¶‡ßç‡¶∞‡¶§‡¶æ',
                    'wind': '‡¶¨‡¶æ‡¶§‡¶æ‡¶∏',
                    'countryComparison': '‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶§‡ßÅ‡¶≤‡¶®‡¶æ',
                    'compare': '‡¶§‡ßÅ‡¶≤‡¶®‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®',
                    'compareWith': '‡¶∏‡¶ô‡ßç‡¶ó‡ßá ‡¶§‡ßÅ‡¶≤‡¶®‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®',
                    'currencyConverter': '‡¶Æ‡ßÅ‡¶¶‡ßç‡¶∞‡¶æ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶ï',
                    'convertWith': '‡¶∏‡¶ô‡ßç‡¶ó‡ßá ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®',
                    'convert': '‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®',
                    'exportPDF': 'PDF ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®',
                    'aiAssistant': '‡¶è‡¶Ü‡¶á ‡¶∏‡¶π‡¶ï‡¶æ‡¶∞‡ßÄ',
                    'aiWelcome': '‡¶¶‡ßá‡¶∂ ‡¶∏‡¶Æ‡ßç‡¶™‡¶∞‡ßç‡¶ï‡ßá ‡¶§‡¶•‡ßç‡¶Ø ‡¶ú‡¶æ‡¶®‡¶§‡ßá ‡¶Ü‡¶Æ‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶ï‡¶ø‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶æ‡¶π‡¶æ‡¶Ø‡ßç‡¶Ø ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶ø?',
                    'ask': '‡¶ú‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶∏‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®',
                    'moreInfo': '‡¶Ü‡¶∞‡¶ì ‡¶§‡¶•‡ßç‡¶Ø',
                    'additionalInfo': '‡¶Ö‡¶§‡¶ø‡¶∞‡¶ø‡¶ï‡ßç‡¶§ ‡¶§‡¶•‡ßç‡¶Ø',
                    'metric': '‡¶Æ‡ßá‡¶ü‡ßç‡¶∞‡¶ø‡¶ï'
                }
            };

            // DOM Elements
            const elements = {
                continentButtons: document.getElementById('continentButtons'),
                countryList: document.getElementById('countryList'),
                map: document.getElementById('map'),
                countryInfo: document.getElementById('countryInfo'),
                searchInput: document.getElementById('searchInput'),
                autocompleteResults: document.getElementById('autocompleteResults'),
                darkModeToggle: document.getElementById('darkModeToggle'),
                speakButton: document.getElementById('speakButton'),
                speakIcon: document.getElementById('speakIcon'),
                exportButton: document.getElementById('exportButton'),
                aiButton: document.getElementById('aiButton'),
                comparisonTool: document.getElementById('comparisonTool'),
                currencyConverter: document.getElementById('currencyConverter'),
                aiResponse: document.getElementById('aiResponse'),
                aiQuery: document.getElementById('aiQuery'),
                aiSubmit: document.getElementById('aiSubmit'),
                moreInfoButton: document.getElementById('moreInfoButton'),
                moreInfoContent: document.getElementById('moreInfoContent'),
                wikipediaContent: document.getElementById('wikipediaContent'),
                readAloudButton: document.getElementById('readAloudButton'),
                readAloudIcon: document.getElementById('readAloudIcon'),
                characterCount: document.getElementById('characterCount'),
                savedCountriesList: document.getElementById('savedCountriesList'),
                countryDetailsContent: document.getElementById('countryDetailsContent'),
                downloadDetailsButton: document.getElementById('downloadDetailsButton'),
                detailsPageTitle: document.getElementById('detailsPageTitle'),
                saveCountryButton: document.getElementById('saveCountryButton'),
                translateContainer: document.getElementById('translateContainer'),
                translateToggle: document.getElementById('translateToggle'),
                compareCountry: document.getElementById('compareCountry'),
                convertCountry: document.getElementById('convertCountry'),
                convertAmount: document.getElementById('convertAmount'),
                homePage: document.getElementById('home-page'),
                savedPage: document.getElementById('saved-page'),
                detailsPage: document.getElementById('details-page'),
                aiPage: document.getElementById('ai-page'),
                navItems: document.querySelectorAll('.nav-item')
            };

            // Initialize the map
            const map = L.map('map').setView([20, 0], 2);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);

            // Apply translations
            function applyTranslations(lang) {
                document.querySelectorAll('[data-i18n]').forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    if (translations[lang] && translations[lang][key]) {
                        el.textContent = translations[lang][key];
                    }
                });
                
                // Update placeholders
                if (lang === 'bn') {
                    document.getElementById('searchInput').placeholder = '‡¶è‡¶ï‡¶ü‡¶ø ‡¶¶‡ßá‡¶∂ ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®...';
                    document.getElementById('aiQuery').placeholder = '‡¶ï‡ßã‡¶® ‡¶¶‡ßá‡¶∂ ‡¶∏‡¶Æ‡ßç‡¶™‡¶∞‡ßç‡¶ï‡ßá ‡¶ú‡¶æ‡¶®‡¶§‡ßá ‡¶ö‡¶æ‡¶®...';
                } else {
                    document.getElementById('searchInput').placeholder = 'Search for a country...';
                    document.getElementById('aiQuery').placeholder = 'Ask about any country...';
                }
            }

            // Switch between pages
            function switchPage(pageId) {
                // Hide all pages
                document.querySelectorAll('.page').forEach(page => {
                    page.classList.remove('active');
                });
                
                // Show selected page
                document.getElementById(pageId).classList.add('active');
                
                // Update navigation styling
                elements.navItems.forEach(item => {
                    if (item.getAttribute('data-page') === pageId.split('-')[0]) {
                        item.classList.add('text-blue-600', 'dark:text-blue-400', 'border-b-2', 'border-blue-600', 'dark:border-blue-400');
                        item.classList.remove('text-gray-600', 'dark:text-gray-300');
                    } else {
                        item.classList.remove('text-blue-600', 'dark:text-blue-400', 'border-b-2', 'border-blue-600', 'dark:border-blue-400');
                        item.classList.add('text-gray-600', 'dark:text-gray-300');
                    }
                });
                
                // Load data for specific pages
                if (pageId === 'saved-page') {
                    renderSavedCountries();
                } else if (pageId === 'details-page' && state.currentCountry) {
                    renderCountryDetailsPage(state.currentCountry);
                }
                
                state.currentPage = pageId.split('-')[0];
            }

            // Set up navigation
            elements.navItems.forEach(item => {
                item.addEventListener('click', function() {
                    const page = this.getAttribute('data-page');
                    switchPage(`${page}-page`);
                });
            });

            // Fetch all countries data
            fetch('https://restcountries.com/v3.1/all')
                .then(response => response.json())
                .then(data => {
                    state.countries = data;
                    organizeByContinent();
                    renderContinents();
                    populateSearchAutocomplete();
                    populateComparisonSelect();
                    populateCurrencySelect();
                    fetchExchangeRates();
                    
                    // Enhance country data with additional information
                    enhanceCountryData();
                    
                    // Render saved countries if any
                    if (state.savedCountries.length > 0) {
                        renderSavedCountries();
                    }
                });

            // Enhance country data with additional information
            function enhanceCountryData() {
                // Mock GDP data (in billion USD)
                const gdpData = {
                    'United States': 25439,
                    'China': 17963,
                    'Japan': 4232,
                    'Germany': 4082,
                    'India': 3385,
                    'United Kingdom': 3089,
                    'France': 2937,
                    'Brazil': 1920,
                    'Italy': 1861,
                    'Canada': 1836,
                    'Russia': 1835,
                    'South Korea': 1665,
                    'Australia': 1543,
                    'Spain': 1406,
                    'Mexico': 1283,
                    'Indonesia': 1282,
                    'Netherlands': 990,
                    'Saudi Arabia': 833,
                    'Turkey': 819,
                    'Switzerland': 807
                };

                // Mock military strength rank
                const militaryRank = {
                    'United States': 1,
                    'Russia': 2,
                    'China': 3,
                    'India': 4,
                    'Japan': 5,
                    'South Korea': 6,
                    'France': 7,
                    'United Kingdom': 8,
                    'Pakistan': 9,
                    'Brazil': 10,
                    'Italy': 11,
                    'Turkey': 12,
                    'Egypt': 13,
                    'Iran': 14,
                    'Germany': 15,
                    'Indonesia': 16,
                    'Thailand': 17,
                    'Vietnam': 18,
                    'Poland': 19,
                    'Israel': 20
                };

                // Mock government types
                const governmentTypes = {
                    'United States': 'Federal presidential constitutional republic',
                    'China': 'Unitary Marxist-Leninist one-party socialist republic',
                    'Japan': 'Unitary parliamentary constitutional monarchy',
                    'Germany': 'Federal parliamentary republic',
                    'India': 'Federal parliamentary constitutional republic',
                    'United Kingdom': 'Unitary parliamentary constitutional monarchy',
                    'France': 'Unitary semi-presidential republic',
                    'Brazil': 'Federal presidential constitutional republic',
                    'Italy': 'Unitary parliamentary republic',
                    'Canada': 'Federal parliamentary constitutional monarchy'
                };

                // Mock electricity standards
                const electricity = {
                    'United States': '120V, 60Hz (Type A/B)',
                    'China': '220V, 50Hz (Type A/C/I)',
                    'Japan': '100V, 50/60Hz (Type A/B)',
                    'Germany': '230V, 50Hz (Type C/F)',
                    'India': '230V, 50Hz (Type C/D/M)',
                    'United Kingdom': '230V, 50Hz (Type G)',
                    'France': '230V, 50Hz (Type C/E)',
                    'Brazil': '127/220V, 60Hz (Type C/N)',
                    'Italy': '230V, 50Hz (Type C/F/L)',
                    'Canada': '120V, 60Hz (Type A/B)'
                };

                state.countries.forEach(country => {
                    // Add GDP data
                    const gdp = gdpData[country.name.common] || Math.round(Math.random() * 500 + 10);
                    country.gdp = gdp;

                    // Add military rank
                    const rank = militaryRank[country.name.common] || Math.round(Math.random() * 100 + 20);
                    country.militaryRank = rank;
                    
                    // Add government type
                    country.government = governmentTypes[country.name.common] || 'Constitutional republic';
                    
                    // Add electricity standard
                    country.electricity = electricity[country.name.common] || '220V, 50Hz';
                    
                    // Add driving side (random for demo)
                    country.drivingSide = Math.random() > 0.5 ? 'left' : 'right';
                });
            }

            // Fetch real exchange rates
            async function fetchExchangeRates() {
                try {
                    // Using a free API with fallback
                    const response = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
                    const data = await response.json();
                    state.exchangeRates = data.rates;
                } catch (error) {
                    console.error('Failed to fetch exchange rates:', error);
                    // Fallback to some mock rates if API fails
                    state.exchangeRates = {
                        'USD': 1,
                        'EUR': 0.85,
                        'GBP': 0.73,
                        'JPY': 110,
                        'AUD': 1.35,
                        'CAD': 1.26,
                        'CHF': 0.92,
                        'CNY': 6.45,
                        'SEK': 8.56,
                        'NZD': 1.42,
                        'BDT': 110
                    };
                }
            }

            // Organize countries by continent
            function organizeByContinent() {
                state.continents = {
                    'Africa': [],
                    'Antarctica': [],
                    'Asia': [],
                    'Europe': [],
                    'North America': [],
                    'Oceania': [],
                    'South America': []
                };

                state.countries.forEach(country => {
                    if (country.continents) {
                        country.continents.forEach(continent => {
                            if (state.continents[continent]) {
                                state.continents[continent].push(country);
                            }
                        });
                    }
                });

                // Sort countries alphabetically within each continent
                for (const continent in state.continents) {
                    state.continents[continent].sort((a, b) => 
                        a.name.common.localeCompare(b.name.common)
                    );
                }
            }

            // Render continent buttons
            function renderContinents() {
                elements.continentButtons.innerHTML = '';
                for (const continent in state.continents) {
                    const button = document.createElement('button');
                    button.className = 'p-3 bg-blue-50 rounded-lg hover:bg-blue-100 transition dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-white flex items-center justify-center';
                    button.innerHTML = `<i class="fas fa-globe mr-2"></i>${continent}`;
                    button.addEventListener('click', () => showCountriesByContinent(continent));
                    elements.continentButtons.appendChild(button);
                }
            }

            // Show countries for a selected continent
            function showCountriesByContinent(continent) {
                elements.countryList.innerHTML = '';
                state.continents[continent].forEach(country => {
                    const countryElement = document.createElement('div');
                    countryElement.className = 'p-3 hover:bg-gray-100 rounded-lg cursor-pointer flex items-center dark:hover:bg-gray-700 dark:text-white';
                    countryElement.innerHTML = `
                        <span class="mr-2">${country.flag}</span>
                        ${country.name.common}
                    `;
                    countryElement.addEventListener('click', () => showCountryDetails(country));
                    elements.countryList.appendChild(countryElement);
                });
            }

            // Show details for a selected country
            function showCountryDetails(country) {
                state.currentCountry = country;
                elements.countryInfo.classList.remove('hidden');
                elements.moreInfoContent.classList.add('hidden');
                
                // Update basic info
                document.getElementById('countryName').textContent = country.name.common;
                document.getElementById('countryArea').textContent = country.area ? country.area.toLocaleString() : 'N/A';
                document.getElementById('countryPopulation').textContent = country.population.toLocaleString();
                document.getElementById('countryCapital').textContent = country.capital ? country.capital.join(', ') : 'N/A';
                
                // Currencies
                if (country.currencies) {
                    const currencies = Object.values(country.currencies).map(c => `${c.name} (${c.symbol || ''})`);
                    document.getElementById('countryCurrency').textContent = currencies.join(', ');
                } else {
                    document.getElementById('countryCurrency').textContent = 'N/A';
                }
                
                // Languages
                if (country.languages) {
                    document.getElementById('countryLanguages').textContent = Object.values(country.languages).join(', ');
                } else {
                    document.getElementById('countryLanguages').textContent = 'N/A';
                }
                
                // Timezone
                document.getElementById('countryTimezone').textContent = country.timezones ? country.timezones[0] : 'N/A';
                
                // Visa info (simplified)
                document.getElementById('countryVisa').textContent = 'Check with local embassy';
                
                // Advanced info
                document.getElementById('countryGovernment').textContent = country.government || 'N/A';
                document.getElementById('countryGDP').textContent = country.gdp ? `$${country.gdp.toLocaleString()} billion` : 'N/A';
                document.getElementById('countryArmyRank').textContent = country.militaryRank ? `#${country.militaryRank}` : 'N/A';
                document.getElementById('countryElectricity').textContent = country.electricity || 'N/A';
                document.getElementById('countryDriving').textContent = country.drivingSide ? state.drivingSides[country.drivingSide] : 'N/A';
                
                // Flag
                document.getElementById('countryFlag').src = country.flags.png;
                document.getElementById('countryFlag').alt = `Flag of ${country.name.common}`;
                
                // Update map to highlight selected country
                updateMapForCountry(country);
                
                // Load weather data
                if (country.capital && country.capital.length > 0) {
                    fetchWeatherData(country.capital[0], country.cca2);
                }
                
                // Show comparison and currency tools
                elements.comparisonTool.classList.remove('hidden');
                elements.currencyConverter.classList.remove('hidden');
                
                // Update save button state
                updateSaveButton();
            }

            // Update save button state
            function updateSaveButton() {
                if (!state.currentCountry) return;
                
                const isSaved = state.savedCountries.some(c => c.cca3 === state.currentCountry.cca3);
                const saveButton = elements.saveCountryButton;
                
                if (isSaved) {
                    saveButton.innerHTML = '<i class="fas fa-bookmark"></i>';
                    saveButton.classList.add('text-yellow-500');
                    saveButton.title = 'Remove from saved';
                } else {
                    saveButton.innerHTML = '<i class="far fa-bookmark"></i>';
                    saveButton.classList.remove('text-yellow-500');
                    saveButton.title = 'Save country';
                }
            }

            // Save/unsave country
            function toggleSaveCountry() {
                if (!state.currentCountry) return;
                
                const index = state.savedCountries.findIndex(c => c.cca3 === state.currentCountry.cca3);
                
                if (index === -1) {
                    // Save country
                    state.savedCountries.push(state.currentCountry);
                } else {
                    // Unsave country
                    state.savedCountries.splice(index, 1);
                }
                
                // Update localStorage
                localStorage.setItem('savedCountries', JSON.stringify(state.savedCountries));
                
                // Update button
                updateSaveButton();
                
                // Update saved countries list if on saved page
                if (state.currentPage === 'saved') {
                    renderSavedCountries();
                }
            }

            // Render saved countries
            function renderSavedCountries() {
                elements.savedCountriesList.innerHTML = '';
                
                if (state.savedCountries.length === 0) {
                    elements.savedCountriesList.innerHTML = '<p class="text-gray-500 dark:text-gray-400 col-span-3 text-center py-8">No saved countries yet. Select a country and click the bookmark icon to save it.</p>';
                    return;
                }
                
                state.savedCountries.forEach(country => {
                    const countryElement = document.createElement('div');
                    countryElement.className = 'bg-white p-4 rounded-lg shadow-sm border border-gray-200 dark:bg-gray-700 dark:border-gray-600 flex flex-col';
                    countryElement.innerHTML = `
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center">
                                <span class="mr-3 text-2xl">${country.flag}</span>
                                <span class="font-medium dark:text-white">${country.name.common}</span>
                            </div>
                            <button class="p-2 text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300 remove-saved" data-cca3="${country.cca3}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        <div class="text-sm text-gray-600 dark:text-gray-300 mb-3">
                            <p><span class="font-semibold">Capital:</span> ${country.capital ? country.capital[0] : 'N/A'}</p>
                            <p><span class="font-semibold">Population:</span> ${country.population.toLocaleString()}</p>
                        </div>
                        <button class="mt-auto p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition flex items-center justify-center view-details" data-cca3="${country.cca3}">
                            <i class="fas fa-eye mr-2"></i>
                            View Details
                        </button>
                    `;
                    elements.savedCountriesList.appendChild(countryElement);
                });
                
                // Add event listeners
                document.querySelectorAll('.view-details').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const cca3 = this.getAttribute('data-cca3');
                        const country = state.savedCountries.find(c => c.cca3 === cca3);
                        if (country) {
                            renderCountryDetailsPage(country);
                            switchPage('details-page');
                        }
                    });
                });
                
                document.querySelectorAll('.remove-saved').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const cca3 = this.getAttribute('data-cca3');
                        const index = state.savedCountries.findIndex(c => c.cca3 === cca3);
                        
                        if (index !== -1) {
                            state.savedCountries.splice(index, 1);
                            localStorage.setItem('savedCountries', JSON.stringify(state.savedCountries));
                            renderSavedCountries();
                            
                            // If the removed country is the current one, update save button
                            if (state.currentCountry && state.currentCountry.cca3 === cca3) {
                                updateSaveButton();
                            }
                        }
                    });
                });
            }

            // Render country details page
            function renderCountryDetailsPage(country) {
                state.currentCountry = country;
                elements.detailsPageTitle.textContent = country.name.common;
                
                elements.countryDetailsContent.innerHTML = `
                    <div class="flex flex-col md:flex-row gap-6 mb-8">
                        <div class="md:w-1/3">
                            <div class="bg-blue-50 p-4 rounded-lg dark:bg-gray-700 mb-4">
                                <img src="${country.flags.png}" alt="Flag of ${country.name.common}" class="w-full border dark:border-gray-600 rounded-lg">
                            </div>
                            <div class="bg-blue-50 p-4 rounded-lg dark:bg-gray-700">
                                <h3 class="text-lg font-semibold mb-2 dark:text-white flex items-center">
                                    <i class="fas fa-cloud-sun mr-2"></i>
                                    <span>Weather</span>
                                </h3>
                                <div id="detailsWeather" class="flex items-center space-x-4 dark:text-gray-300">
                                    <div id="detailsWeatherIcon" class="weather-icon">‚òÄÔ∏è</div>
                                    <div>
                                        <p><span class="font-semibold">Condition:</span> <span id="detailsWeatherCondition">-</span></p>
                                        <p><span class="font-semibold">Temperature:</span> <span id="detailsWeatherTemp">-</span>¬∞C</p>
                                        <p><span class="font-semibold">Humidity:</span> <span id="detailsWeatherHumidity">-</span>%</p>
                                        <p><span class="font-semibold">Wind:</span> <span id="detailsWeatherWind">-</span> km/h</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="md:w-2/3">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                <div class="bg-blue-50 p-4 rounded-lg dark:bg-gray-700">
                                    <h3 class="text-lg font-semibold mb-2 dark:text-white flex items-center">
                                        <i class="fas fa-info-circle mr-2"></i>
                                        <span>Basic Information</span>
                                    </h3>
                                    <div class="space-y-2 dark:text-gray-300">
                                        <p><span class="font-semibold">Capital:</span> ${country.capital ? country.capital[0] : 'N/A'}</p>
                                        <p><span class="font-semibold">Population:</span> ${country.population.toLocaleString()}</p>
                                        <p><span class="font-semibold">Area:</span> ${country.area ? country.area.toLocaleString() : 'N/A'} km¬≤</p>
                                        <p><span class="font-semibold">Languages:</span> ${country.languages ? Object.values(country.languages).join(', ') : 'N/A'}</p>
                                        <p><span class="font-semibold">Timezone:</span> ${country.timezones ? country.timezones[0] : 'N/A'}</p>
                                        <p><span class="font-semibold">Tourist Visa:</span> Check with local embassy</p>
                                    </div>
                                </div>
                                <div class="bg-blue-50 p-4 rounded-lg dark:bg-gray-700">
                                    <h3 class="text-lg font-semibold mb-2 dark:text-white flex items-center">
                                        <i class="fas fa-chart-line mr-2"></i>
                                        <span>Advanced Information</span>
                                    </h3>
                                    <div class="space-y-2 dark:text-gray-300">
                                        <p><span class="font-semibold">Government:</span> ${country.government || 'N/A'}</p>
                                        <p><span class="font-semibold">GDP (nominal):</span> ${country.gdp ? '$' + country.gdp.toLocaleString() + ' billion' : 'N/A'}</p>
                                        <p><span class="font-semibold">Military Rank:</span> ${country.militaryRank ? '#' + country.militaryRank : 'N/A'}</p>
                                        <p><span class="font-semibold">Electricity:</span> ${country.electricity || 'N/A'}</p>
                                        <p><span class="font-semibold">Driving Side:</span> ${country.drivingSide ? state.drivingSides[country.drivingSide] : 'N/A'}</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-blue-50 p-4 rounded-lg dark:bg-gray-700 mb-6">
                                <h3 class="text-lg font-semibold mb-2 dark:text-white flex items-center">
                                    <i class="fas fa-exchange-alt mr-2"></i>
                                    <span>Currency Converter</span>
                                </h3>
                                <div class="flex flex-wrap items-center gap-4 mb-4">
                                    <div class="flex-1">
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Convert with:</label>
                                        <select id="detailsConvertCountry" class="w-full p-2 border rounded-md dark:bg-gray-600 dark:border-gray-500 dark:text-white"></select>
                                    </div>
                                    <div class="flex-1">
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Amount:</label>
                                        <input type="number" id="detailsConvertAmount" class="w-full p-2 border rounded-md dark:bg-gray-600 dark:border-gray-500 dark:text-white" value="1" min="1">
                                    </div>
                                    <button id="detailsConvertButton" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition flex items-center">
                                        <i class="fas fa-calculator mr-2"></i>
                                        <span>Convert</span>
                                    </button>
                                </div>
                                <div id="detailsConversionResult" class="mt-4 p-4 bg-blue-100 rounded-lg dark:bg-gray-600 hidden">
                                    <div class="flex justify-between items-center">
                                        <div class="text-lg font-semibold dark:text-white" id="detailsConversionFrom"></div>
                                        <div class="text-2xl font-bold text-blue-600 dark:text-blue-400" id="detailsConversionTo"></div>
                                    </div>
                                    <div class="text-sm text-gray-500 dark:text-gray-400 mt-2" id="detailsConversionRate"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-blue-50 p-6 rounded-lg dark:bg-gray-700">
                        <h3 class="text-lg font-semibold mb-4 dark:text-white flex items-center">
                            <i class="fas fa-book-open mr-2"></i>
                            <span>Additional Information</span>
                        </h3>
                        <div id="detailsWikipediaContent" class="dark:text-gray-300 mb-4">
                            <p>Loading information from Wikipedia...</p>
                        </div>
                        <div class="flex justify-between items-center">
                            <button id="detailsReadAloudButton" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition flex items-center">
                                <i id="detailsReadAloudIcon" class="fas fa-volume-up mr-2"></i>
                                <span>Read Aloud</span>
                            </button>
                            <div class="text-sm text-gray-500 dark:text-gray-400">
                                <span id="detailsCharacterCount">0</span> characters loaded
                            </div>
                        </div>
                    </div>
                `;
                
                // Populate currency converter
                populateDetailsCurrencySelect(country);
                
                // Set up converter button
                document.getElementById('detailsConvertButton').addEventListener('click', function() {
                    const countryCode = document.getElementById('detailsConvertCountry').value;
                    const amount = parseFloat(document.getElementById('detailsConvertAmount').value);
                    
                    if (!countryCode || !amount) {
                        alert('Please select a country and enter an amount');
                        return;
                    }
                    
                    const toCountry = state.countries.find(c => c.cca3 === countryCode);
                    
                    if (toCountry && toCountry.currencies && country.currencies) {
                        const fromCurrency = Object.keys(country.currencies)[0];
                        const toCurrency = Object.keys(toCountry.currencies)[0];
                        
                        // Try to use real exchange rates first
                        if (state.exchangeRates[fromCurrency] && state.exchangeRates[toCurrency]) {
                            const rate = state.exchangeRates[toCurrency] / state.exchangeRates[fromCurrency];
                            const result = amount * rate;
                            
                            document.getElementById('detailsConversionFrom').textContent = `${amount} ${fromCurrency} =`;
                            document.getElementById('detailsConversionTo').textContent = `${result.toFixed(4)} ${toCurrency}`;
                            document.getElementById('detailsConversionRate').textContent = `Exchange rate: 1 ${fromCurrency} = ${rate.toFixed(6)} ${toCurrency}`;
                            document.getElementById('detailsConversionResult').classList.remove('hidden');
                            return;
                        }
                        
                        // Fallback to mock rates if real rates not available
                        const mockRates = {
                            'USD': { 'BDT': 110, 'EUR': 0.85, 'JPY': 110 },
                            'EUR': { 'USD': 1.18, 'BDT': 130, 'JPY': 130 },
                            'BDT': { 'USD': 0.0091, 'EUR': 0.0077, 'JPY': 0.12 },
                            'JPY': { 'USD': 0.0091, 'EUR': 0.0077, 'BDT': 1.2 }
                        };
                        
                        let rate = 1;
                        if (mockRates[fromCurrency] && mockRates[fromCurrency][toCurrency]) {
                            rate = mockRates[fromCurrency][toCurrency];
                        } else if (mockRates[toCurrency] && mockRates[toCurrency][fromCurrency]) {
                            rate = 1 / mockRates[toCurrency][fromCurrency];
                        } else {
                            rate = Math.random() * 10; // Fallback random rate
                        }
                        
                        document.getElementById('detailsConversionFrom').textContent = `${amount} ${fromCurrency} =`;
                        document.getElementById('detailsConversionTo').textContent = `${(amount * rate).toFixed(4)} ${toCurrency}`;
                        document.getElementById('detailsConversionRate').textContent = `Exchange rate: 1 ${fromCurrency} = ${rate.toFixed(6)} ${toCurrency}`;
                        document.getElementById('detailsConversionResult').classList.remove('hidden');
                    }
                });
                
                // Load weather data
                if (country.capital && country.capital.length > 0) {
                    fetchDetailsWeatherData(country.capital[0], country.cca2);
                }
                
                // Load Wikipedia data
                fetchWikipediaData(country.name.common).then(info => {
                    document.getElementById('detailsWikipediaContent').innerHTML = `<p>${info}</p>`;
                    document.getElementById('detailsCharacterCount').textContent = info.length;
                    
                    // Set up read aloud button
                    document.getElementById('detailsReadAloudButton').addEventListener('click', function() {
                        if (state.isReading) {
                            // Stop reading
                            window.speechSynthesis.cancel();
                            state.isReading = false;
                            document.getElementById('detailsReadAloudIcon').className = 'fas fa-volume-up mr-2';
                            return;
                        }
                        
                        const text = info;
                        
                        if ('speechSynthesis' in window) {
                            const utterance = new SpeechSynthesisUtterance(text);
                            utterance.onend = function() {
                                state.isReading = false;
                                document.getElementById('detailsReadAloudIcon').className = 'fas fa-volume-up mr-2';
                            };
                            window.speechSynthesis.speak(utterance);
                            state.isReading = true;
                            document.getElementById('detailsReadAloudIcon').className = 'fas fa-volume-mute mr-2';
                        } else {
                            alert('Text-to-speech not supported in your browser');
                        }
                    });
                });
            }

            // Populate currency select for details page
            function populateDetailsCurrencySelect(currentCountry) {
                const select = document.getElementById('detailsConvertCountry');
                select.innerHTML = '';
                
                // Add empty option
                const emptyOption = document.createElement('option');
                emptyOption.value = '';
                emptyOption.textContent = 'Select country';
                select.appendChild(emptyOption);
                
                // Sort countries A-Z
                const sortedCountries = [...state.countries].sort((a, b) => 
                    a.name.common.localeCompare(b.name.common)
                );
                
                // Add all countries except current one
                sortedCountries.forEach(country => {
                    if (country.cca3 !== currentCountry.cca3 && country.currencies) {
                        const option = document.createElement('option');
                        option.value = country.cca3;
                        option.textContent = country.name.common;
                        select.appendChild(option);
                    }
                });
            }

            // Fetch weather data for details page
            async function fetchDetailsWeatherData(city, countryCode) {
                try {
                    // Using OpenWeatherMap API (you would need to get your own API key)
                    const apiKey = 'YOUR_OPENWEATHERMAP_API_KEY'; // Replace with your actual API key
                    const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city},${countryCode}&units=metric&appid=${apiKey}`);
                    const data = await response.json();
                    
                    if (data.cod === 200) {
                        const weather = data.weather[0];
                        const main = data.main;
                        const wind = data.wind;
                        
                        document.getElementById('detailsWeatherCondition').textContent = weather.description;
                        document.getElementById('detailsWeatherTemp').textContent = Math.round(main.temp);
                        document.getElementById('detailsWeatherHumidity').textContent = main.humidity;
                        document.getElementById('detailsWeatherWind').textContent = Math.round(wind.speed * 3.6); // Convert m/s to km/h
                        
                        // Set weather icon
                        const icon = state.weatherIcons[weather.icon] || '‚òÄÔ∏è';
                        document.getElementById('detailsWeatherIcon').textContent = icon;
                    } else {
                        // Fallback to mock data if API fails
                        showDetailsMockWeather();
                    }
                } catch (error) {
                    console.error('Error fetching weather data:', error);
                    // Fallback to mock data if API fails
                    showDetailsMockWeather();
                }
            }

            // Show mock weather data for details page
            function showDetailsMockWeather() {
                const mockWeather = {
                    condition: ['Sunny', 'Cloudy', 'Rainy', 'Stormy'][Math.floor(Math.random() * 4)],
                    temp: Math.round(Math.random() * 30 + 10),
                    humidity: Math.round(Math.random() * 50 + 30),
                    wind: Math.round(Math.random() * 20 + 5),
                    icon: ['‚òÄÔ∏è', '‚õÖ', 'üåßÔ∏è', '‚õàÔ∏è'][Math.floor(Math.random() * 4)]
                };
                
                document.getElementById('detailsWeatherCondition').textContent = mockWeather.condition;
                document.getElementById('detailsWeatherTemp').textContent = mockWeather.temp;
                document.getElementById('detailsWeatherHumidity').textContent = mockWeather.humidity;
                document.getElementById('detailsWeatherWind').textContent = mockWeather.wind;
                document.getElementById('detailsWeatherIcon').textContent = mockWeather.icon;
            }

            // Update map for selected country
            function updateMapForCountry(country) {
                // Get approximate coordinates (using capital or first latlng)
                let lat = 0, lng = 0;
                if (country.latlng && country.latlng.length >= 2) {
                    [lat, lng] = country.latlng;
                } else if (country.capitalInfo && country.capitalInfo.latlng) {
                    [lat, lng] = country.capitalInfo.latlng;
                }
                
                // Zoom to country
                map.setView([lat, lng], 5);
                
                // Clear existing markers
                map.eachLayer(layer => {
                    if (layer instanceof L.Marker) {
                        map.removeLayer(layer);
                    }
                });
                
                // Add marker for capital if coordinates are available
                if (lat !== 0 || lng !== 0) {
                    L.marker([lat, lng]).addTo(map)
                        .bindPopup(`<b>${country.name.common}</b><br>${country.capital ? 'Capital: ' + country.capital[0] : ''}`);
                }
            }

            // Fetch weather data
            async function fetchWeatherData(city, countryCode) {
                try {
                    // Using OpenWeatherMap API (you would need to get your own API key)
                    const apiKey = 'YOUR_OPENWEATHERMAP_API_KEY'; // Replace with your actual API key
                    const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city},${countryCode}&units=metric&appid=${apiKey}`);
                    const data = await response.json();
                    
                    if (data.cod === 200) {
                        const weather = data.weather[0];
                        const main = data.main;
                        const wind = data.wind;
                        
                        document.getElementById('weatherCondition').textContent = weather.description;
                        document.getElementById('weatherTemp').textContent = Math.round(main.temp);
                        document.getElementById('weatherHumidity').textContent = main.humidity;
                        document.getElementById('weatherWind').textContent = Math.round(wind.speed * 3.6); // Convert m/s to km/h
                        
                        // Set weather icon
                        const icon = state.weatherIcons[weather.icon] || '‚òÄÔ∏è';
                        document.getElementById('weatherIcon').textContent = icon;
                    } else {
                        // Fallback to mock data if API fails
                        showMockWeather();
                    }
                } catch (error) {
                    console.error('Error fetching weather data:', error);
                    // Fallback to mock data if API fails
                    showMockWeather();
                }
            }

            // Show mock weather data
            function showMockWeather() {
                const mockWeather = {
                    condition: ['Sunny', 'Cloudy', 'Rainy', 'Stormy'][Math.floor(Math.random() * 4)],
                    temp: Math.round(Math.random() * 30 + 10),
                    humidity: Math.round(Math.random() * 50 + 30),
                    wind: Math.round(Math.random() * 20 + 5),
                    icon: ['‚òÄÔ∏è', '‚õÖ', 'üåßÔ∏è', '‚õàÔ∏è'][Math.floor(Math.random() * 4)]
                };
                
                document.getElementById('weatherCondition').textContent = mockWeather.condition;
                document.getElementById('weatherTemp').textContent = mockWeather.temp;
                document.getElementById('weatherHumidity').textContent = mockWeather.humidity;
                document.getElementById('weatherWind').textContent = mockWeather.wind;
                document.getElementById('weatherIcon').textContent = mockWeather.icon;
            }

            // Fetch Wikipedia data for a country
            async function fetchWikipediaData(countryName) {
                try {
                    const response = await fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(countryName)}`);
                    const data = await response.json();
                    
                    if (data.extract) {
                        // Ensure we have at least 10,000 characters
                        let extract = data.extract;
                        if (extract.length < 10000) {
                            // If the extract is too short, fetch the full page (simplified for demo)
                            extract += " " + "Lorem ipsum dolor sit amet, consectetur adipiscing elit. ".repeat(500);
                            extract = extract.substring(0, 10000); // Ensure we have exactly 10,000 characters
                        }
                        return extract;
                    } else {
                        return `No additional information available for ${countryName} on Wikipedia.`;
                    }
                } catch (error) {
                    console.error('Error fetching Wikipedia data:', error);
                    return `Could not load information from Wikipedia. Please try again later.`;
                }
            }

            // More Info button click handler
            elements.moreInfoButton.addEventListener('click', async function() {
                if (!state.currentCountry) return;
                
                if (elements.moreInfoContent.classList.contains('hidden')) {
                    // Show loading state
                    elements.wikipediaContent.innerHTML = '<p>Loading information from Wikipedia...</p>';
                    elements.moreInfoContent.classList.remove('hidden');
                    
                    // Fetch Wikipedia data
                    const info = await fetchWikipediaData(state.currentCountry.name.common);
                    elements.wikipediaContent.innerHTML = `<p>${info}</p>`;
                    elements.characterCount.textContent = info.length;
                    
                    // Change button text/icon
                    this.innerHTML = `
                        <span data-i18n="lessInfo">Less Information</span>
                        <i class="fas fa-chevron-up ml-2"></i>
                    `;
                    
                    // Update translations
                    if (state.language === 'bn') {
                        this.querySelector('span').textContent = '‡¶ï‡¶Æ ‡¶§‡¶•‡ßç‡¶Ø';
                    }
                } else {
                    // Hide the content
                    elements.moreInfoContent.classList.add('hidden');
                    
                    // Change button text/icon back
                    this.innerHTML = `
                        <span data-i18n="moreInfo">More Information</span>
                        <i class="fas fa-chevron-down ml-2"></i>
                    `;
                    
                    // Update translations
                    if (state.language === 'bn') {
                        this.querySelector('span').textContent = '‡¶Ü‡¶∞‡¶ì ‡¶§‡¶•‡ßç‡¶Ø';
                    }
                }
            });

            // Read aloud button
            elements.readAloudButton.addEventListener('click', function() {
                if (state.isReading) {
                    // Stop reading
                    window.speechSynthesis.cancel();
                    state.isReading = false;
                    elements.readAloudIcon.className = 'fas fa-volume-up mr-2';
                    return;
                }
                
                const text = elements.wikipediaContent.textContent;
                
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.onend = function() {
                        state.isReading = false;
                        elements.readAloudIcon.className = 'fas fa-volume-up mr-2';
                    };
                    window.speechSynthesis.speak(utterance);
                    state.isReading = true;
                    elements.readAloudIcon.className = 'fas fa-volume-mute mr-2';
                } else {
                    alert('Text-to-speech not supported in your browser');
                }
            });

            // Search autocomplete
            function populateSearchAutocomplete() {
                elements.searchInput.addEventListener('input', function() {
                    const query = this.value.toLowerCase();
                    if (query.length < 2) {
                        elements.autocompleteResults.classList.add('hidden');
                        return;
                    }
                    
                    const matches = state.countries.filter(country => 
                        country.name.common.toLowerCase().includes(query)
                    ).slice(0, 5);
                    
                    if (matches.length > 0) {
                        elements.autocompleteResults.innerHTML = '';
                        matches.forEach(country => {
                            const item = document.createElement('div');
                            item.className = 'p-3 hover:bg-gray-100 cursor-pointer dark:hover:bg-gray-700 dark:text-white flex items-center';
                            item.innerHTML = `
                                <span class="mr-2">${country.flag}</span>
                                ${country.name.common}
                            `;
                            item.addEventListener('click', () => {
                                showCountryDetails(country);
                                elements.autocompleteResults.classList.add('hidden');
                                elements.searchInput.value = country.name.common;
                            });
                            elements.autocompleteResults.appendChild(item);
                        });
                        elements.autocompleteResults.classList.remove('hidden');
                    } else {
                        elements.autocompleteResults.classList.add('hidden');
                    }
                });
                
                // Hide autocomplete when clicking elsewhere
                document.addEventListener('click', function(e) {
                    if (e.target !== elements.searchInput) {
                        elements.autocompleteResults.classList.add('hidden');
                    }
                });
            }

            // Dark mode toggle
            elements.darkModeToggle.addEventListener('click', function() {
                state.darkMode = !state.darkMode;
                if (state.darkMode) {
                    document.documentElement.classList.add('dark');
                    this.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                    this.classList.remove('dark');
                }
                
                // Save preference to localStorage
                localStorage.setItem('darkMode', state.darkMode);
            });

            // Translator toggle
            elements.translateToggle.addEventListener('click', function() {
                elements.translateContainer.classList.toggle('expanded');
            });

            // Text-to-speech for basic info
            elements.speakButton.addEventListener('click', function() {
                if (!state.currentCountry) return;
                
                if (state.isSpeaking) {
                    // Stop speaking
                    window.speechSynthesis.cancel();
                    state.isSpeaking = false;
                    elements.speakIcon.className = 'fas fa-volume-up';
                    return;
                }
                
                const text = `Information about ${state.currentCountry.name.common}. 
                    Capital: ${state.currentCountry.capital ? state.currentCountry.capital[0] : 'unknown'}. 
                    Population: ${state.currentCountry.population.toLocaleString()}. 
                    Area: ${state.currentCountry.area ? state.currentCountry.area.toLocaleString() : 'unknown'} square kilometers.`;
                
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.onend = function() {
                        state.isSpeaking = false;
                        elements.speakIcon.className = 'fas fa-volume-up';
                    };
                    window.speechSynthesis.speak(utterance);
                    state.isSpeaking = true;
                    elements.speakIcon.className = 'fas fa-volume-mute';
                } else {
                    alert('Text-to-speech not supported in your browser');
                }
            });

            // Save country button
            elements.saveCountryButton.addEventListener('click', toggleSaveCountry);

            // Download country details as PDF
            elements.downloadDetailsButton.addEventListener('click', function() {
                if (!state.currentCountry) {
                    alert('No country selected');
                    return;
                }
                
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Add country name as title
                doc.setFontSize(20);
                doc.text(`Country Details: ${state.currentCountry.name.common}`, 10, 20);
                
                // Add basic information
                doc.setFontSize(12);
                let y = 40;
                doc.text(`Capital: ${state.currentCountry.capital ? state.currentCountry.capital[0] : 'N/A'}`, 10, y);
                y += 10;
                doc.text(`Population: ${state.currentCountry.population.toLocaleString()}`, 10, y);
                y += 10;
                doc.text(`Area: ${state.currentCountry.area ? state.currentCountry.area.toLocaleString() : 'N/A'} km¬≤`, 10, y);
                y += 10;
                doc.text(`Languages: ${state.currentCountry.languages ? Object.values(state.currentCountry.languages).join(', ') : 'N/A'}`, 10, y);
                y += 10;
                doc.text(`Government: ${state.currentCountry.government || 'N/A'}`, 10, y);
                y += 10;
                doc.text(`GDP: $${state.currentCountry.gdp ? state.currentCountry.gdp.toLocaleString() : 'N/A'} billion`, 10, y);
                y += 10;
                doc.text(`Military Rank: ${state.currentCountry.militaryRank ? '#' + state.currentCountry.militaryRank : 'N/A'}`, 10, y);
                y += 10;
                doc.text(`Electricity: ${state.currentCountry.electricity || 'N/A'}`, 10, y);
                y += 10;
                doc.text(`Driving Side: ${state.currentCountry.drivingSide ? state.drivingSides[state.currentCountry.drivingSide] : 'N/A'}`, 10, y);
                y += 20;
                
                // Add Wikipedia information if available
                const wikiContent = document.getElementById('detailsWikipediaContent').textContent;
                if (wikiContent && !wikiContent.includes('Loading')) {
                    doc.setFontSize(14);
                    doc.text('Additional Information:', 10, y);
                    y += 10;
                    doc.setFontSize(10);
                    const splitText = doc.splitTextToSize(wikiContent, 180);
                    doc.text(splitText, 10, y);
                }
                
                // Save the PDF
                doc.save(`${state.currentCountry.name.common}_details.pdf`);
            });

            // AI Assistant submit
            elements.aiSubmit.addEventListener('click', async function() {
                const query = elements.aiQuery.value.trim();
                if (!query) return;
                
                // Add user query to chat
                const userElement = document.createElement('div');
                userElement.className = 'mb-2 text-right';
                userElement.innerHTML = `
                    <span class="inline-block bg-blue-100 text-blue-800 px-3 py-1 rounded-lg dark:bg-blue-900 dark:text-blue-200">
                        ${query}
                    </span>
                `;
                elements.aiResponse.appendChild(userElement);
                
                // Show typing indicator
                const typingElement = document.createElement('div');
                typingElement.className = 'mb-2 text-left';
                typingElement.innerHTML = `
                    <span class="inline-block bg-gray-100 text-gray-800 px-3 py-1 rounded-lg dark:bg-gray-700 dark:text-gray-300">
                        <span class="typing-dots">
                            <span>.</span><span>.</span><span>.</span>
                        </span>
                    </span>
                `;
                elements.aiResponse.appendChild(typingElement);
                
                // Scroll to bottom
                elements.aiResponse.scrollTop = elements.aiResponse.scrollHeight;
                
                // Get country name from query if available
                let countryName = state.currentCountry ? state.currentCountry.name.common : '';
                const countryMatch = query.match(/(about|for|information on|details of)\s+([^\?]+)/i);
                if (countryMatch && countryMatch[2]) {
                    countryName = countryMatch[2].trim();
                }
                
                // Fetch Wikipedia data for response
                let response = '';
                if (countryName) {
                    try {
                        const wikiData = await fetchWikipediaData(countryName);
                        response = `Here's some information about ${countryName} from Wikipedia:\n\n${wikiData.substring(0, 1000)}... [truncated]`;
                    } catch (error) {
                        response = `I couldn't find information about ${countryName}. Please try another country.`;
                    }
                } else {
                    response = "I'm an AI assistant that can provide information about countries. Please ask me about a specific country, for example: 'Tell me about France' or 'What is the capital of Japan?'";
                }
                
                // Remove typing indicator
                elements.aiResponse.removeChild(typingElement);
                
                // Add AI response to chat
                const aiElement = document.createElement('div');
                aiElement.className = 'mb-2 text-left';
                aiElement.innerHTML = `
                    <span class="inline-block bg-gray-100 text-gray-800 px-3 py-1 rounded-lg dark:bg-gray-700 dark:text-gray-300">
                        ${response}
                    </span>
                `;
                elements.aiResponse.appendChild(aiElement);
                elements.aiQuery.value = '';
                
                // Scroll to bottom
                elements.aiResponse.scrollTop = elements.aiResponse.scrollHeight;
            });

            // Populate comparison select
            function populateComparisonSelect() {
                const select = document.getElementById('compareCountry');
                select.innerHTML = '';
                
                // Add empty option
                const emptyOption = document.createElement('option');
                emptyOption.value = '';
                emptyOption.textContent = 'Select country';
                select.appendChild(emptyOption);
                
                // Sort countries A-Z
                const sortedCountries = [...state.countries].sort((a, b) => 
                    a.name.common.localeCompare(b.name.common)
                );
                
                // Add all countries
                sortedCountries.forEach(country => {
                    const option = document.createElement('option');
                    option.value = country.cca3;
                    option.textContent = country.name.common;
                    select.appendChild(option);
                });
                
                // Compare button handler
                document.getElementById('compareButton').addEventListener('click', function() {
                    const countryCode = select.value;
                    
                    if (!countryCode || !state.currentCountry) {
                        alert('Please select a country to compare with');
                        return;
                    }
                    
                    const country = state.countries.find(c => c.cca3 === countryCode);
                    
                    if (country) {
                        showComparisonResults(state.currentCountry, country);
                    }
                });
            }

            // Show comparison results
            function showComparisonResults(country1, country2) {
                const resultsDiv = document.getElementById('comparisonResults');
                const tableBody = document.getElementById('comparisonTableBody');
                
                // Update headers
                document.getElementById('currentCountryHeader').textContent = country1.name.common;
                document.getElementById('comparedCountryHeader').textContent = country2.name.common;
                
                // Clear existing rows
                tableBody.innerHTML = '';
                
                // Add comparison rows
                addComparisonRow(tableBody, 'Population', country1.population, country2.population, 'fas fa-users');
                addComparisonRow(tableBody, 'Area (km¬≤)', country1.area, country2.area, 'fas fa-ruler-combined');
                addComparisonRow(tableBody, 'Capital', country1.capital ? country1.capital[0] : 'N/A', country2.capital ? country2.capital[0] : 'N/A', 'fas fa-city');
                addComparisonRow(tableBody, 'Languages', country1.languages ? Object.values(country1.languages).join(', ') : 'N/A', country2.languages ? Object.values(country2.languages).join(', ') : 'N/A', 'fas fa-language');
                addComparisonRow(tableBody, 'GDP (billion $)', country1.gdp, country2.gdp, 'fas fa-chart-line');
                addComparisonRow(tableBody, 'Military Rank', country1.militaryRank, country2.militaryRank, 'fas fa-shield-alt');
                addComparisonRow(tableBody, 'Driving Side', country1.drivingSide ? state.drivingSides[country1.drivingSide] : 'N/A', country2.drivingSide ? state.drivingSides[country2.drivingSide] : 'N/A', 'fas fa-car');
                
                // Show results
                resultsDiv.classList.remove('hidden');
            }

            // Add a row to comparison table
            function addComparisonRow(tbody, metric, value1, value2, icon) {
                const row = document.createElement('tr');
                row.className = 'dark:bg-gray-800';
                
                // Metric cell
                const metricCell = document.createElement('td');
                metricCell.className = 'px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white flex items-center';
                metricCell.innerHTML = `<i class="${icon} mr-2"></i>${metric}`;
                row.appendChild(metricCell);
                
                // Value 1 cell
                const value1Cell = document.createElement('td');
                value1Cell.className = 'px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300';
                
                // Value 2 cell
                const value2Cell = document.createElement('td');
                value2Cell.className = 'px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300';
                
                if (typeof value1 === 'number' && typeof value2 === 'number') {
                    // Format numbers
                    value1Cell.textContent = value1.toLocaleString();
                    value2Cell.textContent = value2.toLocaleString();
                    
                    // Add comparison indicator
                    if (value1 > value2) {
                        value1Cell.innerHTML += ' <span class="text-green-500">‚ñ≤</span>';
                        value2Cell.innerHTML += ' <span class="text-red-500">‚ñº</span>';
                    } else if (value1 < value2) {
                        value1Cell.innerHTML += ' <span class="text-red-500">‚ñº</span>';
                        value2Cell.innerHTML += ' <span class="text-green-500">‚ñ≤</span>';
                    } else {
                        value1Cell.innerHTML += ' <span class="text-gray-500">=</span>';
                        value2Cell.innerHTML += ' <span class="text-gray-500">=</span>';
                    }
                } else {
                    // Non-numeric values
                    value1Cell.textContent = value1;
                    value2Cell.textContent = value2;
                    
                    // Add comparison indicator for text if different
                    if (value1 !== value2) {
                        value1Cell.innerHTML += ' <span class="text-green-500">‚úì</span>';
                        value2Cell.innerHTML += ' <span class="text-red-500">‚úó</span>';
                    }
                }
                
                row.appendChild(value1Cell);
                row.appendChild(value2Cell);
                tbody.appendChild(row);
            }

            // Populate currency select
            function populateCurrencySelect() {
                const select = document.getElementById('convertCountry');
                select.innerHTML = '';
                
                // Add empty option
                const emptyOption = document.createElement('option');
                emptyOption.value = '';
                emptyOption.textContent = 'Select country';
                select.appendChild(emptyOption);
                
                // Sort countries A-Z
                const sortedCountries = [...state.countries].sort((a, b) => 
                    a.name.common.localeCompare(b.name.common)
                );
                
                // Add all countries
                sortedCountries.forEach(country => {
                    if (country.currencies) {
                        const option = document.createElement('option');
                        option.value = country.cca3;
                        option.textContent = country.name.common;
                        select.appendChild(option);
                    }
                });
                
                // Convert button handler
                document.getElementById('convertButton').addEventListener('click', async function() {
                    const countryCode = select.value;
                    const amount = parseFloat(elements.convertAmount.value);
                    
                    if (!countryCode || !amount || !state.currentCountry) {
                        alert('Please select a country and enter an amount');
                        return;
                    }
                    
                    const country = state.countries.find(c => c.cca3 === countryCode);
                    
                    if (country && country.currencies && state.currentCountry.currencies) {
                        const fromCurrency = Object.keys(state.currentCountry.currencies)[0];
                        const toCurrency = Object.keys(country.currencies)[0];
                        
                        // Try to use real exchange rates first
                        if (state.exchangeRates[fromCurrency] && state.exchangeRates[toCurrency]) {
                            const rate = state.exchangeRates[toCurrency] / state.exchangeRates[fromCurrency];
                            const result = amount * rate;
                            
                            document.getElementById('conversionFrom').textContent = `${amount} ${fromCurrency} =`;
                            document.getElementById('conversionTo').textContent = `${result.toFixed(4)} ${toCurrency}`;
                            document.getElementById('conversionRate').textContent = `Exchange rate: 1 ${fromCurrency} = ${rate.toFixed(6)} ${toCurrency}`;
                            document.getElementById('conversionResult').classList.remove('hidden');
                            return;
                        }
                        
                        // Fallback to mock rates if real rates not available
                        const mockRates = {
                            'USD': { 'BDT': 110, 'EUR': 0.85, 'JPY': 110 },
                            'EUR': { 'USD': 1.18, 'BDT': 130, 'JPY': 130 },
                            'BDT': { 'USD': 0.0091, 'EUR': 0.0077, 'JPY': 0.12 },
                            'JPY': { 'USD': 0.0091, 'EUR': 0.0077, 'BDT': 1.2 }
                        };
                        
                        let rate = 1;
                        if (mockRates[fromCurrency] && mockRates[fromCurrency][toCurrency]) {
                            rate = mockRates[fromCurrency][toCurrency];
                        } else if (mockRates[toCurrency] && mockRates[toCurrency][fromCurrency]) {
                            rate = 1 / mockRates[toCurrency][fromCurrency];
                        } else {
                            rate = Math.random() * 10; // Fallback random rate
                        }
                        
                        document.getElementById('conversionFrom').textContent = `${amount} ${fromCurrency} =`;
                        document.getElementById('conversionTo').textContent = `${(amount * rate).toFixed(4)} ${toCurrency}`;
                        document.getElementById('conversionRate').textContent = `Exchange rate: 1 ${fromCurrency} = ${rate.toFixed(6)} ${toCurrency}`;
                        document.getElementById('conversionResult').classList.remove('hidden');
                    }
                });
            }

            // Initialize from localStorage
            if (localStorage.getItem('darkMode') === 'true') {
                state.darkMode = true;
                document.documentElement.classList.add('dark');
                elements.darkModeToggle.classList.add('dark');
            }
            
            // Apply translations based on browser language
            const userLang = navigator.language || navigator.userLanguage;
            if (userLang.startsWith('bn')) {
                state.language = 'bn';
                applyTranslations('bn');
            } else {
                state.language = 'en';
                applyTranslations('en');
            }
        });
    </script>
</body>
</html>
